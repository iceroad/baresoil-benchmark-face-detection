<!DOCTYPE html><html lang=en><head><title>Baresoil Face Detection Benchmark (AWS)</title><meta charset=utf-8><meta name=description><meta name=last-modified content="Wed Aug 09 2017 20:30:52 GMT-0700 (PDT)"><meta name=viewport content="width=device-width,initial-scale=1"><link href="__ver__/style.b459734.css" rel="stylesheet"></head><body><div class=container-fluid><div class=row><div class="col-xs-12 bottom-spacer text-center"><h1><a href=https://www.baresoil.org/ >Baresoil</a> Face Detection Benchmark (AWS)</h1><p>This is a repeatable, <span class=extlink><a href=https://github.com/iceroad/baresoil-benchmark-face-detection target=_blank>open code and data</a><span class="glyphicon glyphicon-new-window"></span></span> benchmark.</p><p><span>Benchmark date:&nbsp;</span><strong class=format-short-date data-date="Wed Aug 09 2017 20:30:52 GMT-0700 (PDT)">Wed Aug 09 2017 20:30:52 GMT-0700 (PDT)</strong></p></div></div><div class=row><div class="col-xs-12 col-md-6 col-md-offset-1 bottom-spacer"><table class=links-box><tr><td><span>Demo</span></td><td><span class=extlink><a href=https://faces.baresoil.cloud target=_blank>faces.baresoil.cloud</a><span class="glyphicon glyphicon-new-window"></span></span></td></tr><tr><td>Code and data</td><td><span class=extlink><a href=https://github.com/iceroad/baresoil-benchmark-face-detection target=_blank>iceroad/baresoil-benchmark-face-detection</a><span class="glyphicon glyphicon-new-window"></span></span></td></tr></table><h3>Introduction</h3><p>A recent positive development in <span class=extlink><a href=https://en.wikipedia.org/wiki/Machine_learning target=_blank rel=nofollow>machine learning</a><span class="glyphicon glyphicon-new-window"></span></span> has been the availability of fast and accurate methods for detecting and recognizing human faces in an image. Given a photograph, we would like to know where the human faces (if any) are located in the photograph, as well as the approximate shape of each face. This is an import first step for <span class=extlink><a href=https://en.wikipedia.org/wiki/Face_recognition target=_blank rel=nofollow>face recognition</a><span class="glyphicon glyphicon-new-window"></span></span>, <span class=extlink><a href=https://en.wikipedia.org/wiki/Biometrics target=_blank rel=nofollow>biometrics</a><span class="glyphicon glyphicon-new-window"></span></span>, and instant messaging apps that allow animal parts to be overlaid onto human faces. </p><p><span class=extlink><a href=https://www.baresoil.org/ target=_blank>Baresoil</a><span class="glyphicon glyphicon-new-window"></span></span> can be used to quickly turn standard command-line programs into scalable web services. For this benchmark, Adam Geitgey's <span class=extlink><a href=https://medium.com/@ageitgey/machine-learning-is-fun-part-4-modern-face-recognition-with-deep-learning-c3cffc121d78 target=_blank rel=nofollow>Modern Face Recognition with Deep Learning</a><span class="glyphicon glyphicon-new-window"></span></span> Python tutorial is adapted into a Baresoil server-side function using approximately <span class=extlink><a href=https://github.com/iceroad/baresoil-benchmark-face-detection/blob/master/project/server/face_detect.py target=_blank>100 lines of Python</a><span class="glyphicon glyphicon-new-window"></span></span> from the tutorial. </p><div class=figure-container><div class=figure><img src=__ver__/overview.948e0e4.png title="The images on the right show the location of facial features extracted from each face found in the left image. Each yellow box represents a face, and facial features are outlined in red." alt="The images on the right show the location of facial features extracted from each face found in the left image. Each yellow box represents a face, and facial features are outlined in red."></div><div class=caption>The images on the right show the location of facial features extracted from each face found in the left image. Each yellow box represents a face, and facial features are outlined in red.</div></div><p>The adapted code is deployed to a Baresoil cluster consisting of <strong>5</strong> <strong>c4.8xlarge AWS EC2 instances</strong>. As of <strong class=format-short-date data-date="Wed Aug 09 2017 20:30:52 GMT-0700 (PDT)">Wed Aug 09 2017 20:30:52 GMT-0700 (PDT)</strong>, the overall throughput of this cluster was measured at <strong class=format-number>633</strong> <strong>gigabytes per hour</strong> of image data analyzed for faces, for a total cost of <strong>$8.58</strong> USD per hour. The code and data repository contains the <span class=extlink><a href=https://github.com/iceroad/baresoil-benchmark-face-detection/tree/master/project target=_blank>Baresoil adaptation</a><span class="glyphicon glyphicon-new-window"></span></span> of Adam Geitgey's tutorial. </p></div><div class="col-xs-12 col-md-4"><h3>Summary</h3><table class="table table-compact metrics-table"><tr><td>Images processed per hour</td><td class="metric format-number">120100</td></tr><tr><td>Image data processed per hour</td><td class=metric><span class=format-number>633</span><strong> GB</strong></td></tr><tr><td>Cluster cost per hour (on-demand)<sup>*</sup></td><td class=metric><span>$8.58</span><strong> USD</strong></td></tr><tr><td>Cluster cost per hour (reserved)</td><td class=metric><span>$5.66</span><strong> USD</strong></td></tr></table><p><sup>*</sup> Using <strong>5</strong> on-demand EC2 <strong>c4.8xlarge</strong> instances in <strong>us-east-2</strong>, priced at $<strong>1.591</strong> per hour, RDS on-demand costs of $<strong>0.095</strong> per hour, ELB costs of $<strong>0.025</strong> per hour and $<strong>0.008</strong> per gigabyte transferred. Pixel resolution of all test images is approximately 3840x2160 (i.e., 4K video frame).</p></div></div><hr><div class=row><div class="col-xs-12 col-md-6 col-md-offset-1 bottom-spacer"><h3>Benchmark Setup</h3><dl><dt>Baresoil cluster</dt><dd>A Baresoil cluster is first created to host the face recognition service using the instructions for <span class=extlink><a href=https://www.baresoil.org/docs/install/aws.html target=_blank>creating a Baresoil cluster on AWS</a><span class="glyphicon glyphicon-new-window"></span></span>. This can take 25 minutes or longer in some AWS regions. </dd><dt>Benchmarking client cluster</dt><dd>A standalone cluster of load-generating EC2 instances is created using the <span class=extlink><a href=https://github.com/iceroad/node-benchoid target=_blank rel=nofollow>benchoid</a><span class="glyphicon glyphicon-new-window"></span></span> benchmarking tool, available on npm. </dd><dt>Load generating agents</dt><dd><div>Each of the <strong>10</strong> servers in the test cluster creates <strong>20</strong> parallel processes that each perform the following actions in a loop:</div><ol><li>Connect to the face detection service over an encrypted, persistent WebSocket using the Baresoil cluster's DNS endpoint,</li><li>Randomly choose one of the <span class=extlink><a href=https://github.com/iceroad/baresoil-benchmark-face-detection/tree/master/agent/test_images target=_blank>test images</a><span class="glyphicon glyphicon-new-window"></span></span> and send it to the server to be analyzed for faces.</li><li>Wait for the server response before repeating the previous step.</li></ol><div>After a traffic ramp-up period, this results in <strong class=format-number>200</strong> simultaneous WebSocket connections to the cluster continuously sending images to be analyzed. The source code for the load-generating agent is in the <span class=extlink><a href=https://github.com/iceroad/baresoil-benchmark-face-detection/tree/master/agent target=_blank>agent</a><span class="glyphicon glyphicon-new-window"></span></span> directory of the code and data repository. </div></dd></dl></div><div class="col-xs-12 col-md-4 bottom-spacer"><h4>Baresoil Cluster</h4><table class="table table-compact metrics-table"><tr><td>Instance count</td><td class=metric>5</td></tr><tr><td>Instance type</td><td class=metric>c4.8xlarge</td></tr><tr><td>AWS region</td><td class=metric>us-east-2</td></tr><tr><td>Instance cost per hour (on-demand)</td><td class=metric><span>$1.591</span><strong> USD</strong></td></tr><tr><td>Instance cost per hour (reserved)</td><td class=metric><span>$1.008</span><strong> USD</strong></td></tr></table></div><div class="col-xs-12 col-md-4 bottom-spacer"><h4>Load Generating Instances</h4><table class="table table-compact metrics-table"><tr><td>Instance count</td><td class=metric>10</td></tr><tr><td>Instance type</td><td class=metric>t2.xlarge</td></tr><tr><td>AWS region</td><td class=metric>us-east-2</td></tr></table></div></div><div class=row><div class="col-xs-12 text-center"><h3>Raw Statistics</h3><hr></div></div><div class=row><div class="col-xs-12 col-md-8 col-md-offset-2"><table class="table table-compact metrics-table"><tr><td>Experiment time (seconds)</td><td class="metric format-number">357</td></tr><tr><td>Requests made</td><td class="metric format-number">12110</td></tr><tr><td>Successful responses received</td><td class="metric format-number">11910</td></tr><tr><td>Error responses received</td><td class="metric format-number">0</td></tr><tr><td>Image bytes processed by the cluster</td><td class="metric format-number">67406267535</td></tr><tr><td>Total response bytes returned from cluster</td><td class="metric format-number">747173248</td></tr><tr><td>Total CPU-seconds used by all requests</td><td class="metric format-number">9199121</td></tr></table></div></div><div class=row><div class="col-xs-12 text-center"><h3>Request Statistics</h3><hr></div></div><div class=row><div class="col-xs-12 col-md-5 col-md-offset-1 bottom-spacer"><h4>Request Rate</h4><p>Total number of requests that were initiated to the server in each time window, aggregated over all clients.</p><canvas id=new_requests_over_time></canvas></div><div class="col-xs-12 col-md-5 bottom-spacer"><h4>Image Bytes Processed</h4><p>Total amount of image data processed by the cluster at each time window. Image data is only counted when it is successfully processed by the cluster and returned, at the time of return.</p><canvas id=image_bytes_over_time></canvas></div></div><div class=row><div class="col-xs-12 col-md-5 col-md-offset-1 bottom-spacer"><h4>Server Time per Image</h4><p>Wall time spent by server on resizing each image, as reported by the server.</p><canvas id=walltime_per_image_over_time></canvas></div><div class="col-xs-12 col-md-5 bottom-spacer"><h4>Round-trip Latency</h4><p>Time from starting the RPC request over a WebSocket to receiving a successful response. Requests are grouped by the time they were started at the client, not when the response was successfully received.</p><canvas id=rtt_latency_over_time></canvas></div></div><div class=row><div class="col-xs-12 text-center"><h3>Client Tier Statistics</h3><hr></div></div><div class=row><div class="col-xs-12 col-md-5 col-md-offset-1 bottom-spacer"><h4>Client CPU Usage</h4><p>Instances in the client tier should not be overloaded in order to ensure that server response measurements are not biased. The following time series plot shows average CPU usage for each server in the client tier.</p><canvas id=client_cpu_over_time></canvas></div><div class="col-xs-12 col-md-5 bottom-spacer"><h4>Client Memory Usage</h4><p>The following time series plot shows the percentage of system memory used per host, as free by node's builtin <code>os</code> module.</p><canvas id=client_memory_over_time></canvas></div></div><div class=row><div class="col-xs-12 col-md-5 col-md-offset-1 bottom-spacer"><h4>Concurrent Agents</h4><p>Each agent is an independent process running on one of the client tier instances that makes a continuous stream of requests to the server. The following time series plot shows the total number of active agents over time for all client tier hosts.</p><canvas id=num_agents_over_time></canvas></div></div><hr><div class=row><div class="col-xs-12 col-md-offset-1 col-md-10"><table class=links-box><tr><td>Homepage</td><td><a href=https://www.baresoil.org>www.baresoil.org</a></td></tr><tr><td>Other benchmarks</td><td><a href=https://iceroad.github.io/baresoil-benchmark-image-resizer/ >Image Resizing Benchmark</a></td></tr></table></div></div><hr><footer class=footer>Copyright &copy; 2017 <a href=http://lahiri.me/ >Mayank Lahiri</a></footer></div><script type="text/javascript" src="__ver__/js.688e15c6c1afd75aaa94.bundle.js"></script></body></html>